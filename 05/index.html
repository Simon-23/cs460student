<html>
  <head>
    <style>
      html, body { 
        background-color:#000;
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden !important;  
      }
    </style>

    <script src="https://mrdoob.github.io/stats.js/build/stats.min.js"></script>
    
    <script type="text/javascript" src="http://get.goXTK.com/xtk_xdat.gui.js"></script>

    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@latest/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@latest/examples/jsm/"
      }
    }
    </script>

    <script type="module">

      import * as THREE from 'three';
      import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
      import { PLYLoader } from 'three/addons/loaders/PLYLoader.js';

      var renderer, controls, scene, camera;
      var stats;
      
      // Our Scene helper/controller object
      window['SCENE'] = {
        'anaglyph': false
      };

      window.onload = function() {

        window.THREE = THREE;

        // Three.js code goes here
        scene = new THREE.Scene();

        // setup the camera
        var fov = 75;
        var ratio = window.innerWidth / window.innerHeight;
        var zNear = 1;
        var zFar = 10000;
        camera = new THREE.PerspectiveCamera(fov, ratio, zNear, zFar);
        camera.position.set(0, 0, 100);

        // create renderer and setup the canvas
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement); // Adds canvas element

        // stats.js instance
        stats = new Stats();
        document.body.appendChild(stats.domElement);

        // setup lights
        var ambientLight = new THREE.AmbientLight();
        scene.add(ambientLight);

        var light = new THREE.DirectionalLight(0xffffff, 5.0);
        light.position.set(10, 100, 10);
        scene.add(light);

        // LOAD .PLY FILE
        var loader = new PLYLoader();
        loader.load('armadillo.ply', function(geometry) {

            geometry.computeVertexNormals();

            var material = new THREE.MeshStandardMaterial({
                color: 'red'
            });

            var mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

        });
          
        // interaction
        controls = new OrbitControls(camera, renderer.domElement);

        var gui = new dat.GUI();
        var sceneui = gui.addFolder('Scene');
        gui.add(window.SCENE, 'anaglyph');
        gui.add(light.position, 'x', -100, 100).name('Light x');
        gui.add(light.position, 'y', -100, 100).name('Light y');
        gui.add(light.position, 'z', -100, 100).name('Light z');
        gui.add(light, 'intensity', 1, 100).name('Light Intensity');
        gui.addColor(ambientLight, 'color');
        
        // call animation/rendering loop
        animate();
    
      };   

        function animate() {

          requestAnimationFrame( animate );
          
          stats.update();

          // and here..
          controls.update();

          if (window.SCENE.anaglyph) {
            effect.render(scene, camera); //replaced renderer.x w/effect.x
          } else {
            renderer.render(scene, camera);
          }
          
        };
          

    </script>
  </head>
  <body></body>
</html>
